{% include 'partials/head.html' %}

<body class="bg-gray-50 flex flex-col min-h-screen">
  {% include 'partials/navbar.html' %}

  <main class="flex-grow container mx-auto px-4 py-8">
    <div class="flex justify-between items-center mb-8">
      <h2 class="text-3xl font-bold">Available Projects</h2>
      {% if user.is_authenticated and user.role == 'student' %}
        <a href="{% url 'projects:student_wishlist' %}" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
          <i class="fas fa-heart mr-2"></i>My Wishlist
        </a>
      {% elif user.is_authenticated and user.role == 'admin' %}
        <div class="flex space-x-4">
          <a href="{% url 'projects:create_project' %}" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
            <i class="fas fa-plus mr-2"></i>New Project
          </a>
          <a href="{% url 'projects:admin_project_list' %}" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            <i class="fas fa-cogs mr-2"></i>Manage All
          </a>
        </div>
      {% endif %}
    </div>

    <!-- Search and Filter Section -->
    <div class="bg-white p-6 rounded-lg shadow mb-6">
      <form method="GET" class="flex flex-wrap gap-4">
        <div class="flex-1 min-w-64">
          <input type="text" name="search" value="{{ search_query }}" 
                 placeholder="Search projects..." 
                 class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
          <select name="category" class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="">All Categories</option>
            {% for value, label in categories %}
              <option value="{{ value }}" {% if category_filter == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
          </select>
        </div>
        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
          <i class="fas fa-search mr-2"></i>Search
        </button>
        {% if search_query or category_filter %}
          <a href="{% url 'projects:project_list' %}" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600">
            <i class="fas fa-times mr-2"></i>Clear
          </a>
        {% endif %}
      </form>
    </div>

    <!-- Projects Grid -->
    {% if projects %}
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for project in projects %}
          <div class="bg-white p-6 rounded-lg shadow hover:shadow-md transition-shadow">
            <div class="flex justify-between items-start mb-3">
              <h3 class="text-xl font-bold">{{ project.title }}</h3>
              <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                {{ project.get_category_display }}
              </span>
            </div>
            
            <p class="text-gray-600 mb-4 line-clamp-3">{{ project.description|truncatewords:20 }}</p>
            
            <div class="text-sm text-gray-500 mb-4">
              <div class="flex items-center mb-1">
                <i class="fas fa-user mr-2"></i>
                <span>{{ project.supervisor }}</span>
              </div>
              <div class="flex items-center mb-1">
                <i class="fas fa-clock mr-2"></i>
                <span>{{ project.duration }}</span>
              </div>
              <div class="flex items-center">
                <i class="fas fa-users mr-2"></i>
                <span>Max {{ project.max_students }} student{{ project.max_students|pluralize }}</span>
              </div>
            </div>

            <div class="flex justify-between items-center">
              <a href="{% url 'projects:project_detail' project.pk %}" 
                 class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm">
                View Details
              </a>
              
              {% if user.is_authenticated and user.role == 'student' %}
                {% if project.id in user_wishlist %}
                  <span class="text-green-600 text-sm">
                    <i class="fas fa-heart mr-1"></i>Wishlisted
                  </span>
                {% else %}
                  <a href="{% url 'projects:add_to_wishlist' project.pk %}" 
                     class="text-gray-600 hover:text-red-600 text-sm">
                    <i class="far fa-heart mr-1"></i>Add to Wishlist
                  </a>
                {% endif %}
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center py-12">
        <i class="fas fa-project-diagram text-4xl text-gray-400 mb-4"></i>
        <h3 class="text-xl font-semibold text-gray-600 mb-2">No Projects Found</h3>
        <p class="text-gray-500">
          {% if search_query or category_filter %}
            Try adjusting your search criteria.
          {% else %}
            No projects are currently available.
          {% endif %}
        </p>
      </div>
    {% endif %}
  </main>

  {% include 'partials/footer.html' %}
</body>
</html>
